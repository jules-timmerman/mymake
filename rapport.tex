\documentclass[11pt]{report}
\usepackage[utf8]{inputenc}
\usepackage[french]{babel}
\usepackage[T1]{fontenc}
\usepackage{mathrsfs}

\usepackage[a4paper,width=160mm,top=35mm,bottom=35mm]{geometry}

\usepackage{booktabs}
\usepackage{array}
\usepackage{subfig}
\usepackage{amsmath,amsfonts,amssymb}

\usepackage{mathtools}
\usepackage{titlesec} 
\usepackage{enumitem}
\usepackage{listings}
\usepackage{mathdots}
\usepackage{comment}


% Codes source
\usepackage{listings}
\usepackage{xcolor}

\definecolor{codegreen}{rgb}{0,0.6,0.1}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{blue},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2
}

\lstset{style=mystyle}

% Encadrés
\usepackage{tcolorbox}

% Graphes
\usepackage{tikz}
\usepackage{tikz-cd}


%\renewcommand{\thesection}{\arabic{section}}
%\renewcommand{\thesubsection}{\arabic{subsection}}


\usepackage{parskip}
\usepackage{tgpagella}


\newcounter{question}[section]
\newenvironment{question}[1][]{\refstepcounter{question}\par\medskip
   \noindent\textbf{Question~\thequestion ~ $-$} \rmfamily}{}


\newtcolorbox[auto counter,number within=section]{code}[2][]{
fonttitle=\bfseries,
title=Code source de #2,#1,
colback=white,
colframe=black,
arc=0mm
}


\newcommand{\Codesource}[2]{
\begin{figure}[h]
\lstinputlisting[language=c]{ #2 }
\caption{Code source de \texttt{#1}}
\label{code:#1}
\end{figure}


}

%\newcommand{\Codesource}[2]{
%\begin{code}[]{\texttt{ #1 }}
%\lstinputlisting{ #2 }
%\end{code}
%}


\title{MyMake}
\date{Octobre 2022}
\author{Guilhem Repetto \and Jules Timmerman}










\begin{document}

\maketitle

\begin{abstract}

\end{abstract}




\begin{question}
Pour créer le fichier \texttt{Makefile}, il faut comprendre la dépendance entre les fichiers du projet.
Nous voulons compiler un fichier exécutable \texttt{main} à partir du fichier \texttt{main.c}.

Tout d'abord, rappelons qu'au minimum, le fichier \texttt{main.c} est transformé par le préprocesseur en un fichier \texttt{main.i}, compilé en un fichier assembleur \texttt{main.s}, puis en un fichier binaire \texttt{main.o}. Enfin, l'étape d'édition des liens utilise \texttt{main.o} ainsi que tous les fichiers binaires (en \texttt{.o}) des bibliothèques et des fichiers annexes déclarés dans le \textit{header} de \texttt{main.c} (fichiers en \texttt{.h}) utilisés pour produire un fichier final exécutable \texttt{main}.


Pour produire \texttt{main}, le compilateur a donc besoin du fichier \texttt{main.o}. Dans notre cas, les fichiers \texttt{c.h} et \texttt{d.h} sont déclarés en \textit{header}, ce qui implique que les fichiers \texttt{c.o} et \texttt{d.o} sont aussi demandés. De plus, les fichiers \texttt{a.h} et \texttt{b.h} sont demandés par \texttt{c.h}, et \texttt{a.h} est demandé par \texttt{d.h}. Pour compiler le fichier \texttt{main}, il faut donc avoir accès aux fichiers \texttt{main.o}, \texttt{a.o}, \texttt{b.o}, \texttt{c.o} et \texttt{d.o}.
On ajoute donc les lignes suivantes au fichier \texttt{Makefile} :
\begin{verbatim}
main: main.o a.o b.o c.o d.o
    gcc -o main main.o a.o b.o c.o d.o
\end{verbatim}

Pour le reste, on construit alors un graphe de dépendance (voir figure \ref{fig:dependance_test}), où $\mathtt{x}\rightarrow \mathtt{y}$ signifie que le fichier \texttt{y} a besoin du fichier \texttt{x} pour être compilé.


\begin{figure}[h]
\centering
% https://tikzcd.yichuanshen.de/#N4Igdg9gJgpgziAXAbVABwnAlgFyxMJZABgBpiBdUkANwEMAbAVxiRAB12cYAPHf4FAB0AYwC+IMaXSZc+QijIBGKrUYs2nbnwHCAFhKkzseAkTIAmVfWatEHLr345gdUYekgMJ+edIBma3U7B21nVyEDSU9vOTNFUgAWINtNRx0XEXdo4ziFElIAVhSNey0nASyooy9ZU3yyADYSkPKM4AAjbJrY+r8Adha0sIEu6pi63xQLUhVqG1LQipdhCA9cvumAobL08Lc1nNqfeOQZ4vng4eXgLMOeydOZwcvU3ZGXLvuJk-zEpJ2S3aAFs6FgwOtjnkiP8rK9Fm1wqDwUJ7qoYFAAObwIigABmACcIMCkGQQDgIEgABw1QnEpBKagU6m0okkxAzcmUxAATlZ9MQ-iZ3L5njp7P+XIZxH57MKwulsqQjQViCUSiViH6qvVmqFUrVZIY4JCcAgxqgR3FSH1zMQVOoHRgYEtiBlYrZ1J1Fk1PO9mvV-o9AqUZLtSh9wfZSlt3Ij1D0MDorrATAYDE18oNMcdztd7vxnrVOv1TpdpLEFDEQA
\begin{tikzcd}
\texttt{d.c} \arrow[rrd]                          &  &                            &  &                            \\
\texttt{d.h} \arrow[rr] \arrow[rrrrd]             &  & \texttt{d.o} \arrow[rrddd] &  &                            \\
\texttt{a.c} \arrow[rrd]                          &  &                            &  & \texttt{main.o} \arrow[dd] \\
\texttt{a.h} \arrow[rr] \arrow[rrdd] \arrow[rruu] &  & \texttt{a.o} \arrow[rrd]   &  &                            \\
\texttt{c.c} \arrow[rrd]                          &  &                            &  & \texttt{main}              \\
\texttt{c.h} \arrow[rr] \arrow[rrrruuu]           &  & \texttt{c.o} \arrow[rru]   &  &                            \\
\texttt{b.c} \arrow[rrd]                          &  &                            &  &                            \\
\texttt{b.h} \arrow[rr]                           &  & \texttt{b.o} \arrow[rruuu] &  &                           
\end{tikzcd}
\caption{Relations de dépendance entre les fichiers du dossier \texttt{test}}
\label{fig:dependance_test}
\end{figure}

On peut alors en déduire le fichier \texttt{Makefile} (figure \ref{code:Makefile}).


\Codesource{Makefile}{testproj/Makefile}

\end{question}




\begin{question}


\Codesource{regle.h}{regle.h}
\Codesource{regle.c}{regle.c}

\Codesource{listeRegles.h}{listeRegles.h}
\Codesource{listeRegles.c}{listeRegles.c}

\end{question}

\begin{question}

On obtient le fichier suivant 
\Codesource{Makefile}{Makefile}

\end{question}





\begin{thebibliography}{99}
\bibitem{michou}
  \textit{Thèmes d'analyse (p.139 - 165)},
  Jean-Marie Exbrayat, Michel Alessandri,
  Masson,
  1997.

\bibitem{troisdemis}
  \textit{La suite des puissances de 3/2},
  F.D. et M.M.F.,
  La Recherche,
  2001.
\end{thebibliography}

\end{document}